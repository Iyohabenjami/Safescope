<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>SafeScope</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body { background: #f5f7fa; }
    .card { border-radius: 12px; }
    pre { background: #1e1e1e; color: #fff; padding: 10px; border-radius: 8px; }
  </style>
</head>

<body class="p-4">
  <div class="container">

    <h1 class="fw-bold text-center mb-3">SafeScope</h1>
    <h5 class="text-center mb-4">Threat Intelligence Dashboard<br>VirusTotal · WHOIS · DNS · IP Intelligence</h5>

    <div class="row g-4">

      <!-- FILE SCAN -->
      <div class="col-md-4">
        <div class="card p-3 shadow">
          <h5>File Scan</h5>
          <input type="file" id="fileInput" class="form-control mb-2">
          <button class="btn btn-primary w-100" onclick="scanFile()">Scan File</button>
        </div>
      </div>

      <!-- DOMAIN CHECK -->
      <div class="col-md-4">
        <div class="card p-3 shadow">
          <h5>Domain Check</h5>
          <input id="domainInput" class="form-control mb-2" placeholder="example.com">
          <button class="btn btn-primary w-100" onclick="checkDomain()">Check Domain</button>
        </div>
      </div>

      <!-- IP CHECK -->
      <div class="col-md-4">
        <div class="card p-3 shadow">
          <h5>IP Check</h5>
          <input id="ipInput" class="form-control mb-2" placeholder="8.8.8.8">
          <button class="btn btn-primary w-100" onclick="checkIP()">Check IP</button>
        </div>
      </div>

    </div>

    <!-- RESULTS -->
    <div id="resultBox" class="mt-5" style="display:none;">
      <h3>Details</h3>
      <div class="card p-3 shadow mb-3">
        <p><strong>Verdict:</strong> <span id="verdictText"></span></p>
        <p><strong>Target:</strong> <span id="targetText"></span></p>
      </div>

      <h5>Raw JSON</h5>
      <pre id="jsonOutput"></pre>

      <button class="btn btn-success mt-3" onclick="openReport()">Report</button>
    </div>

    <footer class="text-center mt-5">
      © 2025 SafeScope — Security Intelligence Toolkit
    </footer>
  </div>


  <!-- REPORT MODAL -->
  <div class="modal fade" id="reportModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content p-3">

        <h5>Submit Report</h5>

        <label class="mt-2">Report Type</label>
        <input id="repType" class="form-control">

        <label class="mt-2">Target</label>
        <input id="repTarget" class="form-control">

        <label class="mt-2">Verdict</label>
        <input id="repVerdict" class="form-control">

        <label class="mt-2">Notes (optional)</label>
        <textarea id="repNotes" class="form-control"></textarea>

        <button class="btn btn-primary w-100 mt-3" onclick="submitReport()">Send</button>

      </div>
    </div>
  </div>


<script>
let latestResult = null;

// ------------------- FILE -------------------
async function scanFile(){
  let f = document.getElementById("fileInput").files[0];
  if(!f){ alert("No file selected"); return; }

  let form = new FormData();
  form.append("file", f);

  let r = await axios.post("/scan-file", form);
  showResult(r.data, "file");
}

// ------------------- DOMAIN -------------------
async function checkDomain(){
  let dom = document.getElementById("domainInput").value.trim();
  if(!dom){ alert("Enter domain"); return; }

  let r = await axios.post("/check-domain", { domain: dom });
  showResult(r.data, "domain");
}

// ------------------- IP -------------------
async function checkIP(){
  let ip = document.getElementById("ipInput").value.trim();
  if(!ip){ alert("Enter IP"); return; }

  let r = await axios.post("/check-ip", { ip: ip });
  showResult(r.data, "ip");
}

// ------------------- DISPLAY -------------------
function showResult(data, type){
  latestResult = data;

  document.getElementById("resultBox").style.display = "block";

  document.getElementById("targetText").innerText = data.domain || data.ip || data.filename;
  document.getElementById("verdictText").innerText = data.verdict;

  document.getElementById("jsonOutput").innerText = JSON.stringify(data, null, 2);
}

// ------------------- REPORT -------------------
function openReport(){
  if(!latestResult){ return; }

  document.getElementById("repType").value = latestResult.type || "analysis";
  document.getElementById("repTarget").value = latestResult.domain || latestResult.ip || latestResult.filename;
  document.getElementById("repVerdict").value = latestResult.verdict;

  new bootstrap.Modal(document.getElementById("reportModal")).show();
}

async function submitReport(){
  let body = {
    type: document.getElementById("repType").value,
    target: document.getElementById("repTarget").value,
    verdict: document.getElementById("repVerdict").value,
    notes: document.getElementById("repNotes").value,
    raw: latestResult
  };

  await axios.post("/report", body);

  alert("Report submitted");
  location.reload();
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>